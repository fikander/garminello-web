{% extends 'layouts/default.html' %}

{% block scripts %}
    <script src="//api.trello.com/1/client.js?key={{ trello_api_key }}"></script>
    <script src="/static/javascripts/garminello.js"></script>
{% endblock %}

{% block content %}
<script id="watch_template" type="text/template">
    type: <%= type %>
    active: <%= active %>
    created: <%=created_at %>
    updated: <%= updated_at %>
    activated: <%= activated_at %>
    <button class="delete">Unregister</button>
</script>

<script id="trello_token_template" type="text/template">
    username: <%= username %>
    <button class="delete">Unauthorise</button>
</script>

<div id="root" class="container">
    <div class="page-header text-center">
        <h1><span class="fa fa-anchor"></span> Profile Page</h1>
        <a href="/logout" class="btn btn-default btn-sm">Logout</a>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="well">
                <h3><span class="fa fa-user"></span> Local</h3>
                <p>
                    <strong>id</strong>: {{ user.get('id') }}<br>
                    <strong>email</strong>: {{ user.get('email') }}<br>
                    <div id="trello"></div>
                    <button id="trello_delete">Unauthorise</button>
                </p>
            </div>
            <div class="well">
                TRELLO TOKEN
                <div id="trelloToken"></div>
            </div>
        </div>
        <div class="col-sm-6">
            <div id="watchList">
                <form id="register_watch_form" action="" method="">
                    <div class="form-group">
                        <label>Activation code</label>
                        <input id="activation_code" type="text" class="form-control" name="activation" placeholder="8 character code">
                    </div>
                    <button id="register_watch" type="submit" class="btn btn-warning btn-lg">Register Watch</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    var refreshTrello = function() {
        $.ajax({
            url: '/api/trello_token',
            type: 'GET',
            contentType: "application/json",
            dataType: 'json'
        }).done(function(data) {
            $("#trello").empty();
            $("#trello").append('<div>' + JSON.stringify(data) + '</div>');
        }).fail(function(jqXHR, textStatus) {
            $("#trello").empty();
            console.log(textStatus);
        });
    }

    $(document).ready(function() {
        refreshTrello();

        $('#trello_delete').on('click', function(event) {
            $.ajax({
                url:'/api/trello_token',
                type: 'DELETE'
            }).done(function(data) {
                refreshTrello();
            }).fail(function(jqXHR, textStatus){
                console.log(textStatus);
            });
        });
    });
</script>
{% endblock %}
